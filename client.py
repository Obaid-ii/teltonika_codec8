import socket

def send_raw_data_to_server(host='20.174.9.78', port=9025, imei=None, packet=None):
    if imei is None:
        raise ValueError("No IMEI provided")
    if packet is None:
        raise ValueError("No packet provided")

    # Create a TCP/IP socket
    client_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    
    # Connect the socket to the server
    client_socket.connect((host, port))
    
    try:
        # Step 1: Send IMEI directly as provided
        client_socket.sendall(imei)
        print(f'Sent IMEI to server: {imei}')

        # Step 2: Wait for server's acceptance/rejection (1 byte)
        response = client_socket.recv(1)
        if response == b'\x01':
            print("Server accepted the IMEI.")
            
            # Step 3: Send raw binary AVL data to the server
            client_socket.sendall(packet)
            #print('Sent AVL data to server:', packet)
            # Wait for response
            response = client_socket.recv(8)  # Expecting 8 bytes response
            print(f'Received response from server: {response}')
        else:
            print("Server rejected the IMEI.")
        
    finally:
        # Close the socket
        client_socket.close()

if __name__ == "__main__":
    # IMEI in the exact format provided
    imei = b'\x00\x0F\x33\x35\x36\x33\x30\x37\x30\x34\x32\x34\x34\x31\x30\x31\x33'

    # Example binary packet (replace with your actual data)
    #example_packet = bytes.fromhex('000000000000048B080A0000019208F0A690002B8B350614052A61020200690E000700200EEF01F0011502450171641E001F322053210125002600273F291F325A10B5000BB60007423546180005CD2E37CE507C430FC124038B2801242A01132B0000310984333519340018360000371E7802F10000A029100001BBC9000000019208F0C1E8002B8B325B14052B3A020101260E000600200EEF01F0011502450171641E001F35205321032507260F273F291F325A10B5000AB6000742355D180005CD2E37CE507C430FC12404F02801282A011A2B0000310984333554340012360000371E7802F10000A029100001BBD0000000019208F0E8F8002B8B2F2A14052D81020001160E000000200EEF01F0011502450171641E001F4D2053210725002613273F2922325A10B5000BB6000742355A180000CD2E37CE507C430FC12406582801FE2A01242B0000310984333554340010360000371E7802F10000A029100001BBD9000000019208F10C20002B8B2E2014052FC901FE01640E000A00200EEF01F0011502450171641E001F33205221052504260F273F291F325A10B50010B60007423555180008CD2E37CE507C430FC12403152801542A012C2B00003109843334F234001F360000371E7902F10000A029100001BBE1000000019208F13330002B8B2C6E1405324201FC015A0E000000200EEF01F0011502450171641E001F3120532100250026042740291F325A10B5000AB60007423534180000CD2E37CE507C430FC12403A42801212A01362B000031098433352D340017360000371E7902F10000A029100001BBE8000000019208F15A40002B8B295F140534AB01FA014D0E000500200EEF01F0011502450171641E001F3820532100250626FC2740291F325A10B5000BB60007423502180004CD2E37CE507C430FC12403C028011A2A01402B0000310984333519340016360000371E7902F10000A029100001BBF5000000019208F18150002B8B28121405353001FA01560E000000200EEF01F0011502450171641E001F46205321FF2500261027402922325A10B5000FB6000742353A180000CD2E37CE507C430FC12406E02802FF2A01492B0000310984333519340019360000371E7902F10000A029100001BBF5000000019208F19CA8002B8B24C0140537CB01FA01180E000A00200EEF01F0011502450171641E001F4E20532103250A2608273F2924325A10B50010B60007423550180008CD2E37CE507C430FC12403822802A32A01502B000031098433351934003C360000371E7902F10000A029100001BC03000000019208F1AC48002B8B1F261405352001FB00DC0E001100200EEF01F0011502450171641E001F60205321FE25102601273F2929325A10B50010B6000742354F180011CD2E37CE507C430FC12405782804362A01542B000031098433352D34003D360000371E7902F10000A029100001BC14000000019208F1D358002B8B1D6414051CC601FA00C30E001D00200EEF01F0011503450171641E001F492053210025202612273E2926325A10B50010B6000742355A18001DCD2E37CE507C430FC124068028033D2A015E2B000031098433354034002B360000371E7902F10000A029100001BC5A000A00008981')
    #example_packet = bytes.fromhex('000000000000002808010000016B40D9AD80010000000000000000000000000000000103021503010101425E100000010000F22A')
    #example_packet = b'\x00\x00\x00\x00\x00\x00\x006\x08\x01\x00\x00\x01k@\xd8\xea0\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01\x05\x02\x15\x03\x01\x01\x01B^\x0f\x01\xf1\x00\x00`\x1a\x01N\x00\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\xc7\xcf'
    example_packet = bytes.fromhex('000000000000004308020000016B40D57B480100000000000000000000000000000001010101000000000000016B40D5C198010000000000000000000000000000000101010101000000020000252C')
    send_raw_data_to_server(imei=imei, packet=example_packet)
